version: "3"
services:
    # O composer serve apenas quando for rodar testes na api ou no server com o client
    # Virou Api por causa do nginx, ele tem uma keyword 'server' j√° implantada e poderia ocorrer incompatibilidade
    api:
        stdin_open: true
        build: 
            context: "./api"
            dockerfile: Dockerfile.dev
        restart: on-failure
        volumes: 
            - /api/node_modules
            - ./api:/api
    client:
        stdin_open: true
        build:
            context: "./client/apache-server"
            dockerfile: Dockerfile.dev
        restart: on-failure
        volumes:
            - ./client/php/src:/var/www/html
        environment: 
            - hostname=us-cdbr-east-04.cleardb.com
            - user=b4b78724dfa36d
            - password=55c1e22b
            - db=heroku_a166eef70043d0b
    nginx:
        restart: always
        build: 
            context: ./nginx
            dockerfile: Dockerfile.dev
        ports: 
            - "8000:80"
        depends_on: 
            - api
            - client
    